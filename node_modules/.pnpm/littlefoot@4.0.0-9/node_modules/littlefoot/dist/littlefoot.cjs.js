"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@pacote/get-style"),e=require("@pacote/pixels"),n=require("@pacote/throttle"),r=require("delegated-events"),i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i.apply(this,arguments)};function o(t,e){t.classList.add(e)}function a(t,e){t.classList.remove(e)}function l(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}function c(t){var e=t.offsetHeight,n=t.getBoundingClientRect().top+e/2;return{above:n,below:window.innerHeight-n}}function u(e){var n=parseFloat(t.getStyle(e,"marginLeft")),r=e.offsetWidth-n;return(e.getBoundingClientRect().left+r/2)/window.innerWidth}function s(e,n){var r=2*parseInt(t.getStyle(e,"marginTop"),10)+e.offsetHeight;return n.below<r&&n.below<n.above?"above":"below"}var f=function(t){return!!t.parentElement};function d(n){var r=n.id,i=n.button,d=n.content,v=n.host,p=n.popover,m=n.wrapper,g=!1,h=0,y="above";return{id:r,activate:function(n){var r;i.setAttribute("aria-expanded","true"),o(i,"is-changing"),o(i,"is-active"),i.insertAdjacentElement("afterend",p),p.style.maxWidth=document.body.clientWidth+"px",r=d,h=Math.round(e.pixels(t.getStyle(r,"maxHeight"),r)),null==n||n(p,i)},dismiss:function(t){i.setAttribute("aria-expanded","false"),o(i,"is-changing"),a(i,"is-active"),a(p,"is-active"),null==t||t(p,i)},isActive:function(){return i.classList.contains("is-active")},isReady:function(){return!i.classList.contains("is-changing")},isHovered:function(){return g},ready:function(){o(p,"is-active"),a(i,"is-changing")},remove:function(){l(p),a(i,"is-changing")},reposition:function(){f(p)&&(d.style.maxHeight=function(e,n,r){var i=c(n),o=s(e,i),a=parseInt(t.getStyle(e,"marginTop"),10);return Math.min(r,i[o]-a-15)}(p,i,h)+"px",y=function(t,e,n){var r=s(t,c(e));if(n!==r){a(t,"is-"+n),o(t,"is-"+r);var i=100*u(e)+"%",l="above"===r?"100%":"0";t.style.transformOrigin=i+" "+l}return r}(p,i,y),p.offsetHeight<d.scrollHeight?(o(p,"is-scrollable"),d.setAttribute("tabindex","0")):(a(p,"is-scrollable"),d.removeAttribute("tabindex")))},resize:function(){f(p)&&(p.style.left=function(e,n){var r=e.offsetWidth;return-u(n)*r+parseInt(t.getStyle(n,"marginLeft"),10)+n.offsetWidth/2}(d,i)+"px",m.style.maxWidth=d.offsetWidth+"px",function(t,e){var n=t.querySelector(".littlefoot__tooltip");n&&(n.style.left=100*u(e)+"%")}(p,i))},startHovering:function(){g=!0},stopHovering:function(){g=!1},destroy:function(){return l(v)}}}function v(t,e){t.addEventListener("wheel",n.throttle(function(t){return function(e){var n=e.currentTarget,r=-e.deltaY;r>0&&a(t,"is-fully-scrolled"),n&&r<=0&&r<n.clientHeight+n.scrollTop-n.scrollHeight&&o(t,"is-fully-scrolled")}}(e),16))}var p=function(t){return o(t,"littlefoot--print")};function m(t,e){return Array.from(t.querySelectorAll(e))}function g(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function h(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}function y(t){return void 0!==t}function b(t){var e=t.parentElement,n=function(t,e){return Array.from(t.children).filter((function(t){return 8!==t.nodeType&&t.matches(e)}))}(e,":not(.littlefoot--print)"),r=n.filter((function(t){return"HR"===t.tagName}));n.length===r.length&&(r.concat(e).forEach(p),b(e))}function w(t){var e=t.parentElement;l(t),e.innerHTML.replace("[]","").replace("&nbsp;"," ").trim()||w(e)}function x(t,e){var n=h(t.body.outerHTML);m(n,'[href$="#'+t.referenceId+'"]').forEach(w);var r=n.innerHTML.trim();return{original:t,data:{id:String(e+1),number:e+1,reference:"lf-"+t.referenceId,content:r.startsWith("<")?r:"<p>"+r+"</p>"}}}function A(t){var e=/<%=?\s*(\w+?)\s*%>/g;return function(n){return t.replace(e,(function(t,e){var r;return String(null!==(r=n[e])&&void 0!==r?r:"")}))}}function E(t){var e,n,r,o=t.allowDuplicates,l=t.anchorParentSelector,c=t.anchorPattern,u=t.buttonTemplate,s=t.contentTemplate,f=t.footnoteSelector,w=t.numberResetSelector,E=t.scope,H=function(t,e,n){return m(t,n+' a[href*="#"]').filter((function(t){return(t.href+t.rel).match(e)}))}(document,c,E).map(function(t,e,n,r){var i=[];return function(o){var a=o.href.split("#")[1],l=m(t,"#"+window.CSS.escape(a)).find((function(t){return e||!i.includes(t)})),c=null==l?void 0:l.closest(r);if(c){i.push(c);var u=o.closest(n)||o;return{reference:u,referenceId:u.id||o.id,body:c}}}}(document,o,l,f)).filter(y).map(x).map(w?(e=w,n=0,r=null,function(t){var o=t.original,a=t.data,l=o.reference.closest(e);return n=r===l?n+1:1,r=l,{original:o,data:i(i({},a),{number:n})}}):function(t){return t}).map(function(t,e){var n=A(t),r=A(e);return function(t){var e=t.original,i=t.data,o=i.id,a=h('<span class="'.concat("littlefoot",'">').concat(n(i),"</span>")),l=a.firstElementChild;l.setAttribute("aria-expanded","false"),l.dataset.footnoteButton="",l.dataset.footnoteId=o;var c=h(r(i));c.dataset.footnotePopover="",c.dataset.footnoteId=o;var u=g(c,"littlefoot__wrapper"),s=g(c,"littlefoot__content");return v(s,c),{original:e,data:i,id:o,button:l,host:a,popover:c,content:s,wrapper:u}}}(u,s)).map((function(t){return p(t.original.reference),p(t.original.body),b(t.original.body),t.original.reference.insertAdjacentElement("beforebegin",t.host),t})).map(d);return{footnotes:H,unmount:function(){H.forEach((function(t){return t.destroy()})),m(document,".littlefoot--print").forEach((function(t){return a(t,"littlefoot--print")}))}}}var H={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="'.concat("littlefoot__wrapper",'"><div class="').concat("littlefoot__content",'"><% content %></div></div><div class="').concat("littlefoot__tooltip",'"></div></aside>'),buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};var S=function(t,e){return t.target.closest(e)},_=function(t){return null==t?void 0:t.dataset.footnoteId},T=function(t){return function(e){e.preventDefault();var n=S(e,"[data-footnote-id]"),r=_(n);r&&t(r)}},D=document.addEventListener,L=window.addEventListener;function C(t){var e,i,o,a=new AbortController,l=a.signal,c=(e=t.toggle,i=t.dismissAll,function(t){var n=S(t,"[data-footnote-button]"),r=_(n);r?e(r):S(t,"[data-footnote-popover]")||i()}),u=(o=t.dismissAll,function(t){27!==t.keyCode&&"Escape"!==t.key&&"Esc"!==t.key||o()}),s=n.throttle(t.repositionAll,16),f=n.throttle(t.resizeAll,16),d=T(t.hover),v=T(t.unhover);return D("touchend",c,{signal:l}),D("click",c,{signal:l}),D("keyup",u,{signal:l}),D("gestureend",s,{signal:l}),L("scroll",s,{signal:l}),L("resize",f,{signal:l}),r.on("mouseover","[data-footnote-id]",d),r.on("mouseout","[data-footnote-id]",v),function(){a.abort(),r.off("mouseover","[data-footnote-id]",d),r.off("mouseout","[data-footnote-id]",v)}}function M(t){void 0===t&&(t={});var e=i(i({},H),t),n=function(t,e){var n=t.footnotes,r=t.unmount,i=function(t){return function(n){n.isReady()&&(n.dismiss(e.dismissCallback),setTimeout(n.remove,t))}},o=function(t){return function(r){e.allowMultiple||n.filter((function(t){return t.id!==r.id})).forEach(i(e.dismissDelay)),r.isReady()&&(r.activate(e.activateCallback),r.reposition(),r.resize(),setTimeout(r.ready,t))}},a=function(t){return function(e){var r=n.find((function(t){return t.id===e}));r&&t(r)}};return{activate:function(t,e){return a(o(e))(t)},dismiss:function(t,e){return a(i(e))(t)},dismissAll:function(){return n.forEach(i(e.dismissDelay))},repositionAll:function(){return n.forEach((function(t){return t.reposition()}))},resizeAll:function(){return n.forEach((function(t){return t.resize()}))},toggle:a((function(t){return t.isActive()?i(e.dismissDelay)(t):o(e.activateDelay)(t)})),hover:a((function(t){t.startHovering(),e.activateOnHover&&!t.isActive()&&o(e.hoverDelay)(t)})),unhover:a((function(t){t.stopHovering(),e.dismissOnUnhover&&setTimeout((function(){return n.filter((function(t){return!t.isHovered()})).forEach(i(e.dismissDelay))}),e.hoverDelay)})),unmount:r}}(E(e),e),r=C(n);return{activate:function(t,r){void 0===r&&(r=e.activateDelay),n.activate(t,r)},dismiss:function(t,r){void 0===r&&(r=e.dismissDelay),void 0===t?n.dismissAll():n.dismiss(t,r)},unmount:function(){r(),n.unmount()},getSetting:function(t){return e[t]},updateSetting:function(t,n){e[t]=n}}}exports.default=M,exports.littlefoot=M;
